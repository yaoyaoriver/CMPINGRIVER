<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ping River Water Level Monitoring System, Chiang Mai</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0/dist/chartjs-plugin-annotation.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Neutrals with Action Colors -->
    <!-- Application Structure Plan: The application is designed as a real-time dashboard. The primary user goal is to quickly assess the current river status. The structure starts with a station selector, as it's the main control. This is followed by large, color-coded Key Performance Indicator (KPI) cards for at-a-glance information (current level, flow, status). A historical line chart provides essential context to the current data, showing the recent trend. Finally, a static information section explains the meaning of the status levels. This top-down structure (Control -> Key Info -> Context -> Details) is highly intuitive for a monitoring application. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Station Selection -> Goal: Organize/Filter -> Viz/Presentation: Dropdown Menu -> Interaction: On-change event updates the entire dashboard -> Justification: Allows users to focus on a specific, relevant location. Standard and intuitive for selection. -> Library/Method: HTML <select> + JS.
        - Report Info: Current Water Level/Flow -> Goal: Inform (at a glance) -> Viz/Presentation: Large text KPI cards with color-coding -> Interaction: N/A (Display only) -> Justification: Highlights the most critical, current data for rapid assessment. Color provides an immediate qualitative indicator. -> Library/Method: HTML/Tailwind + JS for dynamic content.
        - Report Info: Historical Water Level Data (24h) -> Goal: Show Change/Trend -> Viz/Presentation: Line Chart -> Interaction: Hover to see exact values at specific times -> Justification: A line chart is the best way to visualize time-series data and understand if the situation is improving or worsening. -> Library/Method: Chart.js (Canvas).
        - Report Info: Status Threshold Definitions -> Goal: Inform/Context -> Viz/Presentation: Styled Text Block/Table -> Interaction: N/A (Static Reference) -> Justification: Provides necessary context for users to understand the data's meaning and potential danger. -> Library/Method: HTML/Tailwind.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .kpi-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            transition: all 0.3s ease-in-out;
        }
        .chart-container {
            position: relative;
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            height: 50vh;
            max-height: 450px;
            width: 100%;
        }
        .status-normal { border-left: 8px solid #22c55e; }
        .status-warning { border-left: 8px solid #facc15; }
        .status-critical { border-left: 8px solid #ef4444; }
    </style>
</head>
<body class="text-gray-800">

    <header class="bg-blue-700 text-white shadow-lg">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <h1 class="text-2xl md:text-3xl font-bold">Ping River Water Level Monitoring System</h1>
            <p class="text-lg text-blue-200">Chiang Mai Province</p>
        </div>
    </header>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8">

        <section id="controls" class="mb-6">
            <div class="max-w-md mx-auto bg-white p-4 rounded-lg shadow">
                <label for="station-select" class="block text-lg font-medium text-gray-700 mb-2">Select Monitoring Station:</label>
                <select id="station-select" class="block w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </select>
            </div>
        </section>
        
        <section id="dashboard-intro" class="mb-8 text-center max-w-3xl mx-auto">
            <p class="text-gray-600">
                This section provides a summary of the latest water situation from your selected station, including the current water level, flow rate, and overall alert status. The chart below shows the water level trend over the past 24 hours to help you quickly assess the situation.
            </p>
        </section>

        <section id="kpi-dashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <div id="level-card" class="kpi-card flex flex-col justify-between">
                <div>
                    <h2 class="text-xl font-semibold text-gray-500">Current Water Level</h2>
                    <p id="current-level" class="text-5xl font-bold my-2">--.-- m</p>
                </div>
                <p class="text-sm text-gray-400">Relative to mean sea level</p>
            </div>
            <div id="flow-card" class="kpi-card flex flex-col justify-between">
                 <div>
                    <h2 class="text-xl font-semibold text-gray-500">Water Flow Rate</h2>
                    <p id="current-flow" class="text-5xl font-bold my-2">--.--</p>
                 </div>
                <p class="text-sm text-gray-400">mÂ³/s</p>
            </div>
            <div id="status-card" class="kpi-card flex flex-col justify-between">
                 <div>
                    <h2 class="text-xl font-semibold text-gray-500">Status</h2>
                    <p id="current-status" class="text-5xl font-bold my-2">Loading</p>
                 </div>
                <p id="last-updated" class="text-sm text-gray-400">Last Updated: --:--</p>
            </div>
        </section>

        <section id="chart-section" class="mb-8">
            <div class="chart-container mx-auto">
                <canvas id="waterLevelChart"></canvas>
            </div>
        </section>

        <section id="info-section" class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-2xl font-bold mb-4">Warning Thresholds</h2>
             <p class="text-gray-600 mb-4">
                The water level is compared against each station's bank level to assess the situation. It is divided into 3 main levels, represented by colors for clarity and quick understanding.
            </p>
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="p-3 font-semibold">Status</th>
                            <th class="p-3 font-semibold">Color</th>
                            <th class="p-3 font-semibold">Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b">
                            <td class="p-3 font-medium">Normal</td>
                            <td class="p-3"><div class="w-6 h-6 bg-green-500 rounded-full"></div></td>
                            <td class="p-3">Water level is below the warning threshold. The situation is safe.</td>
                        </tr>
                        <tr class="border-b">
                            <td class="p-3 font-medium">Warning</td>
                            <td class="p-3"><div class="w-6 h-6 bg-yellow-400 rounded-full"></div></td>
                            <td class="p-3">Water level is rising and approaching the critical threshold. Close monitoring is advised.</td>
                        </tr>
                        <tr>
                            <td class="p-3 font-medium">Critical</td>
                            <td class="p-3"><div class="w-6 h-6 bg-red-500 rounded-full"></div></td>
                            <td class="p-3">Water level is at or near the bank level. High risk of flooding. Prepare for action.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
             <div id="threshold-info" class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <h3 class="font-bold text-blue-800">Thresholds for Station <span id="info-station-name"></span>:</h3>
                <p class="text-blue-700">Bank Level: <span id="info-bank">--.--</span> m | Warning: <span id="info-warning">--.--</span> m | Critical: <span id="info-critical">--.--</span> m</p>
            </div>
        </section>
    </main>

    <footer class="mt-8 py-4 bg-gray-800 text-white text-center">
        <p>Simulated data for demonstration purposes only.</p>
        <p class="text-sm text-gray-400">Reference Source: Hydro and Agro Informatics Institute (Public Organization)</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let waterLevelChart = null;

            const generateHistoryData = (baseLevel, hours = 24) => {
                let data = [];
                let currentDate = new Date();
                for (let i = hours; i >= 0; i--) {
                    let date = new Date(currentDate.getTime() - i * 60 * 60 * 1000);
                    let fluctuation = (Math.random() - 0.5) * 0.5;
                    let trend = (hours - i) / hours * (Math.random() * 0.3 - 0.1);
                    let level = baseLevel + fluctuation + trend;
                    data.push({
                        time: date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false }),
                        level: parseFloat(level.toFixed(2))
                    });
                }
                return data;
            };

            const stationData = {
                'P.1': {
                    id: 'P.1',
                    name: 'P.1 (Nawarat Bridge, Mueang District)',
                    bank_level: 3.70,
                    warning_level: 2.70,
                    critical_level: 3.20,
                    history: generateHistoryData(2.45),
                    flow: 95.8
                },
                'P.67': {
                    id: 'P.67',
                    name: 'P.67 (Ban Mae-tae, San Sai District)',
                    bank_level: 4.80,
                    warning_level: 3.80,
                    critical_level: 4.30,
                    history: generateHistoryData(3.95),
                    flow: 150.2
                },
                'P.75': {
                    id: 'P.75',
                    name: 'P.75 (Ban Tha Pong, Mae Wang District)',
                    bank_level: 8.50,
                    warning_level: 6.50,
                    critical_level: 7.50,
                    history: generateHistoryData(5.1),
                    flow: 77.4
                }
            };
            
            const stationSelect = document.getElementById('station-select');
            
            Object.values(stationData).forEach(station => {
                const option = document.createElement('option');
                option.value = station.id;
                option.textContent = station.name;
                stationSelect.appendChild(option);
            });

            const updateDashboard = (stationId) => {
                const data = stationData[stationId];
                if (!data) return;

                const currentLevel = data.history[data.history.length - 1].level;
                
                const levelCard = document.getElementById('level-card');
                const flowCard = document.getElementById('flow-card');
                const statusCard = document.getElementById('status-card');

                document.getElementById('current-level').textContent = `${currentLevel.toFixed(2)} m`;
                document.getElementById('current-flow').textContent = data.flow.toFixed(2);
                document.getElementById('last-updated').textContent = `Last Updated: ${new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}`;

                let status, colorClass;
                if (currentLevel >= data.critical_level) {
                    status = 'Critical';
                    colorClass = 'status-critical';
                } else if (currentLevel >= data.warning_level) {
                    status = 'Warning';
                    colorClass = 'status-warning';
                } else {
                    status = 'Normal';
                    colorClass = 'status-normal';
                }
                document.getElementById('current-status').textContent = status;

                [levelCard, flowCard, statusCard].forEach(card => {
                    card.className = 'kpi-card flex flex-col justify-between';
                    card.classList.add(colorClass);
                });

                document.getElementById('info-station-name').textContent = data.name;
                document.getElementById('info-bank').textContent = data.bank_level.toFixed(2);
                document.getElementById('info-warning').textContent = data.warning_level.toFixed(2);
                document.getElementById('info-critical').textContent = data.critical_level.toFixed(2);
                
                createOrUpdateChart(data);
            };

            const createOrUpdateChart = (stationData) => {
                const ctx = document.getElementById('waterLevelChart').getContext('2d');
                
                if (waterLevelChart) {
                    waterLevelChart.destroy();
                }

                const labels = stationData.history.map(d => d.time);
                const dataPoints = stationData.history.map(d => d.level);

                waterLevelChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Water Level (m)',
                            data: dataPoints,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3,
                            pointRadius: 2,
                            pointBackgroundColor: '#3b82f6'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: `Water Level - Last 24 Hours - ${stationData.name}`,
                                font: { size: 18, weight: 'bold' },
                                padding: { top: 10, bottom: 20 }
                            },
                            annotation: {
                                annotations: {
                                    warningLine: {
                                        type: 'line',
                                        yMin: stationData.warning_level,
                                        yMax: stationData.warning_level,
                                        borderColor: '#facc15',
                                        borderWidth: 2,
                                        borderDash: [6, 6],
                                        label: {
                                            content: 'Warning Level',
                                            enabled: true,
                                            position: 'end',
                                            backgroundColor: 'rgba(250, 204, 21, 0.8)',
                                            color: '#713f12',
                                            font: { style: 'normal'}
                                        }
                                    },
                                    criticalLine: {
                                        type: 'line',
                                        yMin: stationData.critical_level,
                                        yMax: stationData.critical_level,
                                        borderColor: '#ef4444',
                                        borderWidth: 2,
                                        borderDash: [6, 6],
                                        label: {
                                            content: 'Critical Level',
                                            enabled: true,
                                            position: 'end',
                                            backgroundColor: 'rgba(239, 68, 68, 0.8)',
                                            color: '#ffffff',
                                            font: { style: 'normal'}
                                        }
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: 'Water Level (m. MSL)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Time'
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index',
                        },
                    }
                });
            };
            
            stationSelect.addEventListener('change', (e) => {
                updateDashboard(e.target.value);
            });
            
            updateDashboard(stationSelect.value);
        });

    </script>
</body>
</html>
